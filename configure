#!/bin/bash
FIRST=I0NvbXBpbGVyIHRvIGJlIHVzZWQKQ0MgOj0gZ2NjCgojRGlyZWN0b3JpZXMKVEFSR0VURElSIDo9IGJpbgpCVUlMRERJUiA6PSBidWlsZApJTkNMVURFRElSIDo9IGluY2x1ZGUKU1JDRElSIDo9IHNyYwoKI0ZpbGUgRXh0ZW5zaW9ucwpTUkNFWFQgOj0gYwpPQkpFWFQgOj0gbwoKI0NvbXBpbGVyIGFyZ3VtZW50cwpDRkxBR1MgOj0gLWcgLVdhbGwgLVdlcnJvcgpMSUIgOj0gCklOQyA6PSAtSSAkKElOQ0xVREVESVIpCgo=

SECOND=LlBSRUNJT1VTOiAkKEJVSUxERElSKS8lLiQoT0JKRVhUKQoKI0J1aWxkcyBhbGwgdGFyZ2V0cwphbGw6ICQoVEFSR0VUUykKCgojQ29tcGlsZXMgaW5kaXZpZHVhbCBvYmplY3QgZmlsZXMKJChCVUlMRERJUikvJS4kKE9CSkVYVCk6ICQoU1JDRElSKS8lLiQoU1JDRVhUKQoJQGVjaG8gIkNvbXBpbGluZyAkPCIKCUBta2RpciAtcCAkKHNoZWxsIGRpcm5hbWUgIiRAIikKCUAkKENDKSAkKENGTEFHUykgJChJTkMpIC1jIC1vICRAICQ8CgojVXNlcyBzZWNvbmQgZXhwYW5zaW9uIHRvIGFkZCB0aGUgb2JqZWN0IGZpbGUgZGVwZW5kZW5jaWVzIHRvIHRoZSB0YXJnZXQgcnVsZQojRG93bnNpZGU6IG5vIHR3byB0YXJnZXRzIGNhbiBoYXZlIHNhbWUgbmFtZSByZWdhcmRsZXNzIG9mIHRhcmdldCBkaXJlY3RvcnkKLlNFQ09OREVYUEFOU0lPTjoKJChUQVJHRVRESVIpLyU6ICQkKCQkKl9PQkpFQ1RTKQoJQGVjaG8gIkxpbmtpbmcgJEAiCglAbWtkaXIgLXAgJChzaGVsbCBkaXJuYW1lICIkQCIpCglAJChDQykgJF4gLW8gJEAgJChMSUIpCgojQ2xlYXJzIG91dCB0aGUgdGFyZ2V0IGFuZCBidWlsZGluZyBkaXJlY3RvcmllcwpjbGVhbjoKCUBlY2hvIFJlbW92aW5nIGdlbmVyYXRlZCBmaWxlcwoJQHJtIC1yZiAkKEJVSUxERElSKSAkKFRBUkdFVERJUikKCnJlYnVpbGQ6IGNsZWFuIGFsbAoKLlBIT05ZOgo=

rm -f Makefile
touch Makefile
echo $FIRST | base64 -d >> Makefile

TARGETS="TARGETS := "
OBJDEP=""

while IFS='' read -r line || [[ -n "$line" ]]; do
      I=`expr index "$line" ":"`
      T="${line:0:I-1}"
      D='$(BUILDDIR)/'"${line:I}"
      D="$(echo $D | sed 's/ / \$(BUILDDIR)\//g')"
      echo $D
      
      TARGETS="${TARGETS}"'$(TARGETDIR)/'"${T} "
      OBJDEP="${OBJDEP}${T}_OBJECTS := ${D}"$'\n'
      
done < Targets

echo "$TARGETS" >> Makefile
echo "" >> Makefile
echo "$OBJDEP" >> Makefile

echo $SECOND | base64 -d >> Makefile
